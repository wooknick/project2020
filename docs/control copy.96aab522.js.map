{"version":3,"sources":["control copy.js"],"names":["textInit","document","getElementsByClassName","innerHTML","length","t","d","soundInit","audio","window","AudioContext","webkitAudioContext","wave","key","mod","scale","activity","attack","voices","masterVolume","addEventListener","buffer","createBuffer","source","createBufferSource","connect","destination","noteOn","speechSynthesis","announce","setMotion","emotion","getTheme","notes","Tonal","Scale","returnTheme","Array","i","j","push","console","log","separateTones","theme","octave","theseNotes","a","match","synth","w","f","v","l","x","y","z","gainNode","createGain","osc","createOscillator","gain","setValueAtTime","currentTime","linearRampToValueAtTime","panner","createPanner","setPosition","frequency","value","type","start","setTimeout","stop","disconnect","play","voice","nextPhrase","thisPhrase","drone","Math","floor","random","phraseLen","phrase","noteDelay","b","volume","delay","Note","freq","c","preIndex","elem","querySelector","flkty","Flickity","cellAlign","dragThreshold","pageDots","prevNextButtons","on","ready","change","index","pageUpdate","page"],"mappings":"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","file":"control copy.96aab522.js","sourceRoot":"../src/public","sourcesContent":["var textInit = () => {\n  document.getElementsByClassName(\"pages_text\")[0].innerHTML = `1 / ${\n    document.getElementsByClassName(\"content_cell\").length\n  }`;\n};\ntextInit();\n\n// audio setting\nvar soundInit = false;\nvar t;\nvar d;\nvar audio = new (window.AudioContext || window.webkitAudioContext)();\n\n// tone setting 정보\nvar wave = \"triangle\"; // sine, sawtooth, square, triangle, custom\nvar key = \"g\"; // c, d, e, f, g, a, b\nvar mod = \"\"; // \"\", #, b\nvar scale = \"major\"; // Pentatonic, Major, Minor, Dorian, Phrygian, Lydian, Mixolydian, Aeolian, Locrian\nvar activity = 4000; // 1000, 2000, 4000, 8000\nvar attack = 250; // 10, 250\nvar voices = 1; // 1, 2, 3, 4, 5\nvar masterVolume = 50; // 1 - 100;\n\n// 모바일 버퍼 생성\nwindow.addEventListener(\n  \"touchstart\",\n  function() {\n    // create empty buffer\n    var buffer = audio.createBuffer(1, 1, 22050);\n    var source = audio.createBufferSource();\n    // alert(source);\n    source.buffer = buffer;\n    // connect to output (your speakers)\n    source.connect(audio.destination);\n    // play the file\n    source.noteOn(0);\n  },\n  false\n);\n\nif (window.speechSynthesis) {\n  var announce = window.speechSynthesis;\n}\n\nfunction setMotion(emotion) {\n  if (emotion === 1) {\n    wave = \"sine\";\n    key = \"c\";\n    mod = \"#\"; //\n    scale = \"minor\";\n    activity = 4000;\n    attack = 250;\n    voices = 1;\n    masterVolume = 50;\n  } else if (emotion === 2) {\n    wave = \"square\";\n    key = \"a\";\n    mod = \"M\"; //\n    scale = \"Lydian\";\n    activity = 3000;\n    attack = 250;\n    voices = 2;\n    masterVolume = 70;\n  }\n}\n\nfunction getTheme() {\n  let notes = Tonal.Scale.notes(key + mod + \" \" + scale);\n  let returnTheme = new Array();\n  for (var i = 2; i <= 5; i++) {\n    for (var j = 0; j < notes.length; j++) {\n      returnTheme.push(notes[j] + i + \"\");\n    }\n  }\n  console.log(\"playing phrase: \" + key + mod + \" \" + scale);\n  // returnTheme : [\"G#2\", \"A#2\", \"B#2\", \"D#2\", \"E#2\", \"G#3\", \"A#3\", \"B#3\", \"D#3\", \"E#3\", \"G#4\", \"A#4\", \"B#4\", \"D#4\", \"E#4\", \"G#5\", \"A#5\", \"B#5\", \"D#5\", \"E#5\"]\n  return returnTheme;\n}\n\nfunction separateTones(theme, octave) {\n  let theseNotes = new Array();\n  theseNotes[\"drone\"] = new Array();\n  theseNotes[\"melody\"] = new Array();\n  for (a = 0; a < theme.length; a++) {\n    if (theme[a].match(/\\d+/)[0] <= octave) {\n      theseNotes[\"drone\"].push(theme[a]);\n    } else {\n      theseNotes[\"melody\"].push(theme[a]);\n    }\n  }\n  return theseNotes;\n}\n\nfunction synth(w, f, v, a, l, d, x, y, z) {\n  v = v * (masterVolume / 100);\n\n  if (v == 0) {\n    return;\n  }\n\n  var gainNode = audio.createGain();\n  var osc = audio.createOscillator();\n  gainNode.connect(audio.destination);\n  gainNode.gain.setValueAtTime(0, audio.currentTime);\n  gainNode.gain.linearRampToValueAtTime(v, audio.currentTime + a / 1000);\n  gainNode.gain.linearRampToValueAtTime(\n    0,\n    audio.currentTime + (a / 1000 + l / 1000 + d / 1000)\n  );\n\n  panner = audio.createPanner();\n  panner.setPosition(x, y, z);\n  osc.connect(panner);\n  panner.connect(audio.destination);\n\n  osc.frequency.value = f;\n  osc.type = w;\n  osc.connect(gainNode);\n  osc.start(0);\n\n  var stoptime = (a + l + d) * 1.1;\n\n  setTimeout(function() {\n    gainNode.gain.linearRampToValueAtTime(0, audio.currentTime + 5);\n    osc.stop(audio.currentTime + 7);\n    osc.disconnect(gainNode);\n    gainNode.disconnect(audio.destination);\n  }, stoptime);\n}\n\nfunction play() {\n  for (voice = 0; voice < voices; voice++) {\n    var nextPhrase = 0; // 재생 시간 관련인듯\n    let theme = getTheme(); // 스케일에 따라 note 확보\n    let thisPhrase = separateTones(theme, 2); // note 구분 - 베이스 영역 / 멜로디 영역\n    let drone =\n      thisPhrase[\"drone\"][\n        Math.floor(Math.random() * thisPhrase[\"drone\"].length)\n      ];\n    let phraseLen = Math.floor(Math.random() * thisPhrase[\"melody\"].length);\n    let phrase = new Array();\n    for (a = 0; a < phraseLen; a++) {\n      phrase.push(\n        thisPhrase[\"melody\"][\n          Math.floor(Math.random() * thisPhrase[\"melody\"].length)\n        ]\n      );\n    }\n\n    // melody 노트 예약 일괄 등록\n    var noteDelay = 0;\n    for (b = 0; b <= phrase.length; b++) {\n      let volume = Math.random() * 0.15;\n      let delay = Math.random() * 100 + 150;\n      let length = activity * ((Math.floor(Math.random() * 8) + 1) / 8);\n      let release = attack + length;\n      nextPhrase += release;\n      let x = Math.random() * 300 - 150;\n      let y = Math.random() * 300 - 150;\n      let z = Math.random() * 300 - 150;\n      if (b < phrase.length) {\n        t = setTimeout(\n          `synth(\"${wave}\", ${Tonal.Note.freq(\n            phrase[b]\n          )}, ${volume}, ${attack}, ${length}, ${delay}, ${x}, ${y}, ${z})`,\n          noteDelay + Math.random() * 1000\n        );\n      }\n      noteDelay += length;\n    }\n\n    // drone 노트 예약 등록\n    for (c = 0; c <= 1; c++) {\n      let volume = Math.random() * 0.15;\n      let delay = Math.random() * 100 + 150;\n      let x = Math.random() * 300 - 150;\n      let y = Math.random() * 300 - 150;\n      let z = Math.random() * 300 - 150;\n\n      d = setTimeout(\n        `synth(\"${wave}\",\n        ${Tonal.Note.freq(\n          drone\n        )}, ${volume}, ${attack}, ${nextPhrase}, ${delay}, ${x}, ${y}, ${z})\n        `,\n        voice * (Math.random() * 1000)\n      );\n    }\n  }\n\n  t = setTimeout(function() {\n    play();\n  }, nextPhrase);\n}\n\nfunction stop() {\n  console.log(source);\n  source.stop(0);\n}\n\n// 슬라이드 설정 시작\nvar preIndex = -1;\nvar elem = document.querySelector(\".content\");\nvar flkty = new Flickity(elem, {\n  // options\n  cellAlign: \"left\",\n  dragThreshold: 10,\n  pageDots: false,\n  prevNextButtons: false,\n  on: {\n    ready: function() {\n      console.log(\"start\");\n    },\n    change: function(index) {\n      pageUpdate(index);\n      if (!soundInit) {\n        // playSound(\"init\");\n        play();\n        soundInit = true;\n      }\n      if (preIndex === 2 && index === 3) {\n        // playSound(\"star_gazing\");\n        // stop();\n        setMotion(1);\n        // play();\n      } else if (preIndex === 5 && index === 6) {\n        setMotion(2);\n        // playSound(\"magical_journey\");\n      } else if (preIndex === 6 && index === 5) {\n        // playSound(\"star_gazing\");\n        setMotion(1);\n      } else if (preIndex === 3 && index === 2) {\n        setMotion(2);\n        // playSound(\"dawn\");\n      }\n      preIndex = index;\n    }\n  }\n});\n\nflkty.on(\"staticClick\", () => {\n  //   if (!nowPlaySource) {\n  //     playSound(\"dawn\");\n  //   }\n  // if (!soundInit) {\n  //   playSound(\"init\");\n  //   soundInit = true;\n  // }\n});\n\nvar pageUpdate = page => {\n  document.getElementsByClassName(\"pages_text\")[0].innerHTML = `${page + 1} / ${\n    document.getElementsByClassName(\"content_cell\").length\n  }`;\n};\n"]}